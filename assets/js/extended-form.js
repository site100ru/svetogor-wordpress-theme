document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("extended-contact-form"),t=document.getElementById("extended-submit-btn");t.querySelector(".btn-text"),t.querySelector(".btn-spinner");let n=document.getElementById("extended-form-messages");function r(e,t){t.checked?e.classList.add("active"):e.classList.remove("active")}function c(e){e.classList.add("is-invalid"),e.addEventListener("input",function(){this.classList.remove("is-invalid")},{once:!0}),"SELECT"===e.tagName&&e.addEventListener("change",function(){this.classList.remove("is-invalid")},{once:!0})}function a(){e.querySelectorAll(".is-invalid").forEach(e=>{e.classList.remove("is-invalid")})}function i(e){t.disabled=e}function l(e,t){n.innerHTML=`<div class="alert alert-${t}">${e}</div>`,n.scrollIntoView({behavior:"smooth",block:"nearest"})}document.querySelector('input[name="page-url"]').value=window.location.href,document.querySelector('input[name="page-title"]').value=document.title,document.querySelector('input[name="referrer"]').value=document.referrer||"",document.querySelector('input[name="user-agent"]').value=navigator.userAgent,function e(){let t=document.querySelector(".file-upload"),n=document.querySelector(".file-name");t&&n&&t.addEventListener("change",function(e){if(e.target.files&&e.target.files.length>0){let t=e.target.files[0];if(t.size>5242880){l("Размер файла не должен превышать 5MB","danger"),this.value="",n.textContent="Файл не прикреплен";return}n.textContent=t.name}else n.textContent="Файл не прикреплен"})}(),function e(){let t=document.querySelectorAll(".image-checkbox-container");t.forEach(e=>{let t=e.querySelector('input[type="checkbox"]');t&&(e.addEventListener("click",function(e){e.target!==t&&(e.preventDefault(),t.checked=!t.checked,r(this,t))}),t.addEventListener("change",function(){r(e,this)}),r(e,t))})}(),function e(){let t=document.querySelectorAll(".custom-checkbox-container");t.forEach(e=>{let t=e.querySelector('input[type="checkbox"]');t&&(e.addEventListener("click",function(e){e.target!==t&&(e.preventDefault(),t.checked=!t.checked,r(this,t))}),t.addEventListener("change",function(){r(e,this)}),r(e,t))})}(),e.addEventListener("submit",function t(r){if(r.preventDefault(),n.innerHTML="",a(),!function t(){let n=!0,r=e.querySelector('input[name="your-name"]');r.value.trim()||(c(r),n=!1);let a=e.querySelector('input[name="your-phone"]');a.value.trim()&&/^[\+]?[1-9][\d]{0,15}$/.test(a.value.replace(/[\s\-\(\)]/g,""))||(c(a),n=!1);let i=e.querySelector('input[name="your-email"]');i.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.value)||(c(i),n=!1);let l=e.querySelector('select[name="product-type"]');return l.value||(c(l),n=!1),n}())return;let o=grecaptcha.getResponse();if(!o){l("Пожалуйста, подтвердите, что вы не робот","danger");return}i(!0);let s=new FormData(e);s.append("action","submit_extended_contact_form"),s.append("nonce",extendedForm.nonce),s.append("g-recaptcha-response",o),fetch(extendedForm.ajaxUrl,{method:"POST",body:s}).then(e=>e.json()).then(t=>{i(!1),t.success?(l(t.data.message||"Спасибо! Ваша заявка отправлена. Мы свяжемся с вами в ближайшее время.","success"),function t(){e.reset(),e.querySelectorAll(".image-checkbox-container, .custom-checkbox-container").forEach(e=>{e.classList.remove("active")});let n=document.querySelector(".file-name");n&&(n.textContent="Файл не прикреплен"),a()}()):l(t.data||"Произошла ошибка при отправке. Попробуйте еще раз.","danger"),grecaptcha.reset()}).catch(e=>{i(!1),l("Произошла ошибка при отправке. Попробуйте еще раз.","danger"),grecaptcha.reset()})})});