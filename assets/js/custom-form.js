document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("custom-contact-form"),t=document.getElementById("submit-btn"),n=t.querySelector(".btn-text"),r=t.querySelector(".btn-spinner"),l=document.getElementById("form-messages");function a(e){e.classList.add("is-invalid"),e.addEventListener("input",function(){this.classList.remove("is-invalid")},{once:!0})}function i(){e.querySelectorAll(".is-invalid").forEach(e=>{e.classList.remove("is-invalid")})}function s(e){e?(t.disabled=!0,n.style.display="none",r.style.display="inline-block"):(t.disabled=!1,n.style.display="inline-block",r.style.display="none")}function o(e,t){l.innerHTML=`<div class="alert alert-${t}">${e}</div>`,l.scrollIntoView({behavior:"smooth",block:"nearest"})}document.querySelector('input[name="page-url"]').value=window.location.href,document.querySelector('input[name="page-title"]').value=document.title,document.querySelector('input[name="referrer"]').value=document.referrer||"",document.querySelector('input[name="user-agent"]').value=navigator.userAgent,function e(){let t=document.querySelector(".file-upload"),n=document.querySelector(".file-name");t&&n&&t.addEventListener("change",function(e){if(e.target.files&&e.target.files.length>0){let t=e.target.files[0];if(t.size>5242880){o("Размер файла не должен превышать 5MB","danger"),this.value="",n.textContent="Файл не прикреплен";return}n.textContent=t.name}else n.textContent="Файл не прикреплен"})}(),e.addEventListener("submit",function t(n){if(n.preventDefault(),l.innerHTML="",i(),!function t(){let n=!0,r=e.querySelector('input[name="your-name"]');r.value.trim()||(a(r),n=!1);let l=e.querySelector('input[name="your-phone"]');l.value.trim()&&/^[\+]?[1-9][\d]{0,15}$/.test(l.value.replace(/[\s\-\(\)]/g,""))||(a(l),n=!1);let i=e.querySelector('input[name="your-email"]');return i.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.value)||(a(i),n=!1),n}())return;let r=grecaptcha.getResponse();if(!r){o("Пожалуйста, подтвердите, что вы не робот","danger");return}s(!0);let c=new FormData(e);c.append("action","submit_custom_contact_form"),c.append("nonce",customForm.nonce),c.append("g-recaptcha-response",r),fetch(customForm.ajaxUrl,{method:"POST",body:c}).then(e=>e.json()).then(t=>{s(!1),t.success?(o(t.data.message||"Спасибо! Ваша заявка отправлена. Мы свяжемся с вами в ближайшее время.","success"),function t(){e.reset(),e.querySelectorAll('.image-checkbox-container input[type="checkbox"]').forEach(e=>{e.checked=!1});let n=document.querySelector(".file-name");n&&(n.textContent="Файл не прикреплен"),i()}()):o(t.data||"Произошла ошибка при отправке. Попробуйте еще раз.","danger"),grecaptcha.reset()}).catch(e=>{s(!1),o("Произошла ошибка при отправке. Попробуйте еще раз.","danger"),grecaptcha.reset()})})});