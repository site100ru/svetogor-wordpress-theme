document.addEventListener("DOMContentLoaded",function(){let e="6LdV1IcUAAAAADRQAhpGL8dVj5_t0nZDPh9m_0tn",t=!1,r=null;function n(e){let t=e.querySelector('input[name="page-url"]');t&&(t.value=window.location.href);let r=e.querySelector('input[name="page-title"]');r&&(r.value=document.title);let n=e.querySelector('input[name="product-id"]'),l=e.querySelector('input[name="product-name"]');if(n||l){let c=new URLSearchParams(window.location.search),o=c.get("product_id")||function e(){let t=document.body.className,r=t.match(/postid-(\d+)/);if(r)return r[1];let n=document.querySelector("[data-product-id]");if(n)return n.getAttribute("data-product-id");let l=document.querySelector('meta[name="product-id"]');return l?l.getAttribute("content"):""}(),a=function e(){let t=document.querySelector("h2.product_title, h2.entry-title, .product-title h2");if(t)return t.textContent.trim();let r=document.title;return r?r.split(" | ")[0].split(" - ")[0].trim():""}();n&&o&&!n.value&&(n.value=o),l&&a&&!l.value&&(l.value=a)}}function l(){let l=document.querySelectorAll('form[action*="mails/"], #custom-contact-form, form[id*="contact"], form[id*="callback"], .contact-form');l.forEach(function(l,c){!l.hasAttribute("data-recaptcha-processed")&&(l.setAttribute("data-recaptcha-processed","true"),l.addEventListener("submit",function(c){if(c.preventDefault(),!function e(t){let r=t.querySelectorAll("[required]"),n=!0;if(r.forEach(function(e){e.value.trim()?e.classList.remove("is-invalid"):(e.classList.add("is-invalid"),n=!1)}),!n){let l=t.querySelector("#form-messages, .form-messages");l&&(l.innerHTML='<div class="alert alert-danger">Пожалуйста, заполните все обязательные поля</div>')}return n}(l))return;let o=l.querySelector('button[type="submit"]'),a=o?o.innerHTML:"";o&&(o.disabled=!0,o.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Отправка...'),(function l(c,o="submit"){return new Promise((l,a)=>{if(!t||!r){a(Error("reCAPTCHA API не готова"));return}try{r.ready(function(){r.execute(e,{action:o}).then(function(e){let t=c.querySelector('input[name="g-recaptcha-response"]');t||((t=document.createElement("input")).type="hidden",t.name="g-recaptcha-response",c.appendChild(t)),t.value=e,n(c),l(e)}).catch(function(e){a(e)})})}catch(i){a(i)}})})(l,"contact_form").then(function(e){l.submit()}).catch(function(e){console.error("Ошибка reCAPTCHA:",e),o&&(o.disabled=!1,o.innerHTML=a);let t=l.querySelector("#form-messages, .form-messages");t&&(t.innerHTML=`<div class="alert alert-danger">Ошибка безопасности. Попробуйте обновить страницу.</div>`)})}))})}function c(){let e=document.querySelectorAll(".file-upload");e.forEach(function(e){let t=e.closest(".file-upload-wrapper"),r=t?t.querySelector(".file-name"):null;r&&e.addEventListener("change",function(e){e.target.files.length>0?r.textContent=e.target.files[0].name:r.textContent="Файл не прикреплен"})});let t=document.querySelectorAll(".file-upload-btn");t.forEach(function(e){e.addEventListener("click",function(){let t=e.closest(".file-upload-wrapper"),r=t?t.querySelector(".file-upload"):null;r&&r.click()})})}function o(){let e=document.querySelectorAll("form");e.forEach(function(e){n(e)});let t=document.querySelectorAll(".modal");t.forEach(function(e){e.addEventListener("show.bs.modal",function(){let t=e.querySelector("form");t&&n(t)})});let r=document.querySelectorAll('input[name="quantity"]');r.forEach(function(e){e.addEventListener("change",function(){let t=e.closest("form");t&&n(t)})})}new Promise((n,l)=>{if(t&&"undefined"!=typeof grecaptcha){n();return}let c=document.querySelector('script[src*="recaptcha"]');c&&c.remove();let o=document.createElement("script");o.src=`https://www.google.com/recaptcha/api.js?render=${e}`,o.async=!0,o.defer=!0,o.onload=function(){let e=()=>{"undefined"!=typeof grecaptcha&&grecaptcha.ready?grecaptcha.ready(()=>{t=!0,r=grecaptcha,n()}):setTimeout(e,100)};e()},o.onerror=function(){l(Error("Ошибка загрузки reCAPTCHA API"))},document.head.appendChild(o)}).then(()=>{o(),l(),c()}).catch(e=>{o(),l(),c(),alert("Ошибка загрузки системы безопасности. Обновите страницу или попробуйте позже.")})});